(this["webpackJsonppme-freelance-assistant-frontend"]=this["webpackJsonppme-freelance-assistant-frontend"]||[]).push([[0],{157:function(e,a,t){"use strict";t.r(a);var r=t(0),s=t.n(r),o=t(118),n=t.n(o),i=t(9),l=t(42),c=t(124),d=t(224),u=t(218),m=t(233),h=t(219),j=t(226),b=t(221);const p=b.a.create({baseURL:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"http://localhost:5000/api"});p.interceptors.request.use(e=>{const a=localStorage.getItem("accessToken");return a&&(e.headers.Authorization="Bearer ".concat(a)),e},e=>Promise.reject(e)),p.interceptors.response.use(e=>e,async e=>{const a=e.config;if(e.response&&401===e.response.status&&!a._retry){a._retry=!0;try{const t=localStorage.getItem("refreshToken");if(!t)return window.location.href="/login",Promise.reject(e);const r=await b.a.post("".concat(p.defaults.baseURL,"/auth/refresh-token"),{refreshToken:t});if(r.data&&r.data.accessToken)return localStorage.setItem("accessToken",r.data.accessToken),a.headers.Authorization="Bearer ".concat(r.data.accessToken),p(a)}catch(t){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login?session=expired",Promise.reject(t)}}return Promise.reject(e)});const x=e=>p.post("/auth/register",e),v=e=>p.post("/auth/login",e),O=()=>p.post("/auth/logout"),g=()=>p.get("/auth/me"),f=e=>p.put("/auth/me",e),w=e=>p.post("/auth/forgot-password",{email:e}),S=(e,a)=>p.post("/auth/reset-password",{token:e,password:a});var y=t(2);const T=Object(r.createContext)(),C=()=>Object(r.useContext)(T),E=e=>{let{children:a}=e;const[t,s]=Object(r.useState)(null),[o,n]=Object(r.useState)(!0),[l,c]=Object(r.useState)(null),d=Object(i.q)();Object(r.useEffect)(()=>{(async()=>{if(localStorage.getItem("accessToken"))try{const e=await g();s(e.data.user)}catch(l){var e,a;if(console.error("Erreur lors de la v\xe9rification de l'authentification:",l),l.response&&401!==l.response.status)c((null===(e=l.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.message)||"Erreur de connexion")}n(!1)})()},[]);const u={user:t,loading:o,error:l,register:async e=>{try{n(!0);const a=await x(e);return localStorage.setItem("accessToken",a.data.tokens.accessToken),localStorage.setItem("refreshToken",a.data.tokens.refreshToken),s(a.data.user),a.data}catch(l){var a,t;throw c((null===(a=l.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Erreur lors de l'inscription"),l}finally{n(!1)}},login:async e=>{try{n(!0);const a=await v(e);return localStorage.setItem("accessToken",a.data.tokens.accessToken),localStorage.setItem("refreshToken",a.data.tokens.refreshToken),s(a.data.user),a.data}catch(l){var a,t;throw c((null===(a=l.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Erreur lors de la connexion"),l}finally{n(!1)}},logout:async()=>{try{n(!0),await O(),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),s(null),d("/login")}catch(l){console.error("Erreur lors de la d\xe9connexion:",l)}finally{n(!1)}},updateProfile:async e=>{try{n(!0);const a=await f(e);return s(a.data.user),a.data}catch(l){var a,t;throw c((null===(a=l.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Erreur lors de la mise \xe0 jour du profil"),l}finally{n(!1)}},forgotPassword:async e=>{try{n(!0);return(await w(e)).data}catch(l){var a,t;throw c((null===(a=l.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Erreur lors de la demande de r\xe9initialisation"),l}finally{n(!1)}},resetPassword:async(e,a)=>{try{n(!0);return(await S(e,a)).data}catch(l){var t,r;throw c((null===(t=l.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"Erreur lors de la r\xe9initialisation du mot de passe"),l}finally{n(!1)}},isAuthenticated:!!t};return Object(y.jsx)(T.Provider,{value:u,children:a})};var P=t(234),A=t(229),_=t(236),k=t(230),R=t(222),I=t(220),B=t(227),L=t(225),W=t(228),D=t(237),q=t(231),F=t(232),U=t(66),V=t(33);const H=V.a({email:V.c().email("Adresse email invalide").required("L'email est requis"),password:V.c().required("Le mot de passe est requis")});var K=()=>{var e,a;const{login:t}=C(),s=Object(i.q)(),o=Object(i.o)(),[n,c]=Object(r.useState)(!1),[d,u]=Object(r.useState)(null),m=o.search.includes("session=expired"),h=(null===(e=o.state)||void 0===e||null===(a=e.from)||void 0===a?void 0:a.pathname)||"/dashboard",j=Object(U.a)({initialValues:{email:"",password:"",rememberMe:!1},validationSchema:H,onSubmit:async e=>{try{c(!0),u(null),await t({email:e.email,password:e.password}),s(h,{replace:!0})}catch(d){var a,r;console.error("Erreur de connexion:",d),u((null===(a=d.response)||void 0===a||null===(r=a.data)||void 0===r?void 0:r.message)||"Erreur lors de la connexion")}finally{c(!1)}}});return Object(y.jsx)(P.a,{component:"main",maxWidth:"xs",children:Object(y.jsxs)(A.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(y.jsx)(_.a,{component:"h1",variant:"h4",sx:{mb:2},children:"Admin Assistant"}),Object(y.jsxs)(k.a,{elevation:3,sx:{p:4,width:"100%"},children:[Object(y.jsx)(_.a,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Connexion"}),d&&Object(y.jsx)(R.a,{severity:"error",sx:{mb:3},children:d}),m&&Object(y.jsx)(R.a,{severity:"info",sx:{mb:3},children:"Votre session a expir\xe9. Veuillez vous reconnecter."}),Object(y.jsxs)("form",{onSubmit:j.handleSubmit,children:[Object(y.jsx)(I.a,{margin:"normal",fullWidth:!0,id:"email",label:"Adresse email",name:"email",autoComplete:"email",autoFocus:!0,value:j.values.email,onChange:j.handleChange,onBlur:j.handleBlur,error:j.touched.email&&Boolean(j.errors.email),helperText:j.touched.email&&j.errors.email}),Object(y.jsx)(I.a,{margin:"normal",fullWidth:!0,name:"password",label:"Mot de passe",type:"password",id:"password",autoComplete:"current-password",value:j.values.password,onChange:j.handleChange,onBlur:j.handleBlur,error:j.touched.password&&Boolean(j.errors.password),helperText:j.touched.password&&j.errors.password}),Object(y.jsx)(B.a,{control:Object(y.jsx)(L.a,{name:"rememberMe",color:"primary",checked:j.values.rememberMe,onChange:j.handleChange}),label:"Se souvenir de moi"}),Object(y.jsx)(W.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:n,children:n?Object(y.jsx)(D.a,{size:24}):"Connexion"}),Object(y.jsxs)(q.a,{container:!0,children:[Object(y.jsx)(q.a,{item:!0,xs:!0,children:Object(y.jsx)(F.a,{component:l.b,to:"/forgot-password",variant:"body2",children:"Mot de passe oubli\xe9 ?"})}),Object(y.jsx)(q.a,{item:!0,children:Object(y.jsx)(F.a,{component:l.b,to:"/register",variant:"body2",children:"Pas de compte ? S'inscrire"})})]})]})]}),Object(y.jsx)(A.a,{mt:5,children:Object(y.jsxs)(_.a,{variant:"body2",color:"text.secondary",align:"center",children:["\xa9 ",(new Date).getFullYear()," Admin Assistant App"]})})]})})};const z=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"http://localhost:5000/api",N=V.a({email:V.c().email("Adresse email invalide").required("L'email est requis")});var M=()=>{const e=Object(i.q)(),[a,t]=Object(r.useState)(!1),[s,o]=Object(r.useState)(null),[n,c]=Object(r.useState)(null),d=Object(U.a)({initialValues:{email:""},validationSchema:N,onSubmit:async a=>{try{t(!0),o(null),c(null);const r=await b.a.post("".concat(z,"/auth/forgot-password"),{email:a.email}),{resetToken:s}=r.data;c("Un lien de r\xe9initialisation a \xe9t\xe9 g\xe9n\xe9r\xe9. Vous allez \xeatre redirig\xe9..."),setTimeout(()=>{e("/reset-password/".concat(s))},2e3)}catch(s){var r,n;console.error("Erreur lors de la demande de r\xe9initialisation:",s),o((null===(r=s.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||"Une erreur est survenue.")}finally{t(!1)}}});return Object(y.jsx)(P.a,{component:"main",maxWidth:"xs",children:Object(y.jsxs)(A.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(y.jsx)(_.a,{component:"h1",variant:"h4",sx:{mb:2},children:"Admin Assistant"}),Object(y.jsxs)(k.a,{elevation:3,sx:{p:4,width:"100%"},children:[Object(y.jsx)(_.a,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"Mot de passe oubli\xe9"}),s&&Object(y.jsx)(R.a,{severity:"error",sx:{mb:3},children:s}),n&&Object(y.jsx)(R.a,{severity:"success",sx:{mb:3},children:n}),Object(y.jsxs)("form",{onSubmit:d.handleSubmit,children:[Object(y.jsx)(I.a,{margin:"normal",fullWidth:!0,id:"email",label:"Adresse email",name:"email",autoComplete:"email",autoFocus:!0,value:d.values.email,onChange:d.handleChange,onBlur:d.handleBlur,error:d.touched.email&&Boolean(d.errors.email),helperText:d.touched.email&&d.errors.email}),Object(y.jsx)(W.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:a,children:a?Object(y.jsx)(D.a,{size:24}):"Envoyer"}),Object(y.jsx)(A.a,{textAlign:"center",children:Object(y.jsx)(F.a,{component:l.b,to:"/login",variant:"body2",children:"Retour \xe0 la connexion"})})]})]})]})})};const J=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"http://localhost:5000/api",Y=V.a({password:V.c().min(8,"Le mot de passe doit contenir au moins 8 caract\xe8res").required("Le mot de passe est requis"),confirmPassword:V.c().oneOf([V.b("password"),null],"Les mots de passe doivent correspondre").required("La confirmation du mot de passe est requise")});var G=()=>{const e=Object(i.q)(),{token:a}=Object(i.s)(),[t,s]=Object(r.useState)(!1),[o,n]=Object(r.useState)(null),[l,c]=Object(r.useState)(null),d=Object(U.a)({initialValues:{password:"",confirmPassword:""},validationSchema:Y,onSubmit:async t=>{try{s(!0),n(null),c(null),await b.a.post("".concat(J,"/auth/reset-password"),{token:a,password:t.password}),c("Votre mot de passe a \xe9t\xe9 r\xe9initialis\xe9 avec succ\xe8s. Vous allez \xeatre redirig\xe9 vers la page de connexion."),setTimeout(()=>{e("/login")},3e3)}catch(o){var r,i;console.error("Erreur lors de la r\xe9initialisation:",o),n((null===(r=o.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||"Une erreur est survenue.")}finally{s(!1)}}});return Object(y.jsx)(P.a,{component:"main",maxWidth:"xs",children:Object(y.jsxs)(A.a,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[Object(y.jsx)(_.a,{component:"h1",variant:"h4",sx:{mb:2},children:"Admin Assistant"}),Object(y.jsxs)(k.a,{elevation:3,sx:{p:4,width:"100%"},children:[Object(y.jsx)(_.a,{component:"h2",variant:"h5",sx:{mb:3,textAlign:"center"},children:"R\xe9initialiser le mot de passe"}),o&&Object(y.jsx)(R.a,{severity:"error",sx:{mb:3},children:o}),l&&Object(y.jsx)(R.a,{severity:"success",sx:{mb:3},children:l}),Object(y.jsxs)("form",{onSubmit:d.handleSubmit,children:[Object(y.jsx)(I.a,{margin:"normal",fullWidth:!0,name:"password",label:"Nouveau mot de passe",type:"password",id:"password",value:d.values.password,onChange:d.handleChange,onBlur:d.handleBlur,error:d.touched.password&&Boolean(d.errors.password),helperText:d.touched.password&&d.errors.password}),Object(y.jsx)(I.a,{margin:"normal",fullWidth:!0,name:"confirmPassword",label:"Confirmer le mot de passe",type:"password",id:"confirmPassword",value:d.values.confirmPassword,onChange:d.handleChange,onBlur:d.handleBlur,error:d.touched.confirmPassword&&Boolean(d.errors.confirmPassword),helperText:d.touched.confirmPassword&&d.errors.confirmPassword}),Object(y.jsx)(W.a,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:t,children:t?Object(y.jsx)(D.a,{size:24}):"R\xe9initialiser"})]})]})]})})};const Q=e=>{let{children:a}=e;const{isAuthenticated:t,loading:r}=C();return r?Object(y.jsx)("div",{children:"Chargement..."}):t?a:Object(y.jsx)(i.a,{to:"/login"})},X=Object(c.a)({palette:{mode:"light",primary:{main:"#1976d2"},secondary:{main:"#f50057"}},typography:{fontFamily:["Poppins","Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(",")}});var Z=()=>Object(y.jsxs)(d.a,{theme:X,children:[Object(y.jsx)(u.a,{}),Object(y.jsx)(m.a,{dateAdapter:h.a,adapterLocale:j.a,children:Object(y.jsx)(l.a,{children:Object(y.jsx)(E,{children:Object(y.jsxs)(i.d,{children:[Object(y.jsx)(i.b,{path:"/login",element:Object(y.jsx)(K,{})}),Object(y.jsx)(i.b,{path:"/forgot-password",element:Object(y.jsx)(M,{})}),Object(y.jsx)(i.b,{path:"/reset-password/:token",element:Object(y.jsx)(G,{})}),Object(y.jsx)(i.b,{path:"/",element:Object(y.jsx)(Q,{children:Object(y.jsx)(i.a,{to:"/dashboard",replace:!0})})})]})})})})]});var $=e=>{e&&e instanceof Function&&t.e(3).then(t.bind(null,239)).then(a=>{let{getCLS:t,getFID:r,getFCP:s,getLCP:o,getTTFB:n}=a;t(e),r(e),s(e),o(e),n(e)})};n.a.createRoot(document.getElementById("root")).render(Object(y.jsx)(s.a.StrictMode,{children:Object(y.jsx)(Z,{})})),$()}},[[157,1,2]]]);
//# sourceMappingURL=main.146dd1ee.chunk.js.map